define(["ytos.cart"],function(a){return yTos.utils.namespace("yTos.helpers.Cart.MiniCart"),yTos.helpers.Cart.MiniCart=yTos.helpers.base.extend({initialize:function(){this._hideTimeout=null,this.isAddingItem=!1,this._isRemovingItem=!1,this._updateOnNextCall=!0,this.options.activeCheckoutType&&""!==this.options.activeCheckoutType||(this.options.activeCheckoutType="Checkout")},options:{showOnCartLinkMouseEnter:!0,toggleOnCartLinkClick:!1,showOnItemAdded:!0,hideOnItemAdded:!0,hideOnCartLinkMouseLeave:!0,hideOnMiniCartMouseLeave:!0,hideTimeoutFromCartLink:250,hideTimeoutFromMiniCart:250,hideTimeoutOnItemAdded:3e3,showIfEmpty:!1},events:{mouseenter:"yTos::Cart::MiniCartMouseEnter",mouseleave:"yTos::Cart::MiniCartMouseLeave","[data-ytos-action='close'] click":"hide","[data-ytos-action='gotocart'] click":"_goToCartPage"},globalMessages:{"yTos::Cart::ItemsAdded":"_updateOnItemsAdded","yTos::Item::ItemAdded":"_updateOnItemsAdded","yTos::Item::ItemAddedToShoppingBag":"_updateOnItemsAdded","yTos::Product::ProductAddedToShoppingBag":"_updateOnItemsAdded","yTos::Cart::CartLinkMouseEnter":"_cartLinkMouseEnterHandler","yTos::Cart::CartLinkMouseLeave":"_cartLinkMouseLeaveHandler","yTos::Cart::CartLinkClicked":"_cartLinkClickHandler","yTos::Checkout::LinkToShoppingBagMouseEnter":"_cartLinkMouseEnterHandler","yTos::Checkout::LinkToShoppingBagMouseLeave":"_cartLinkMouseLeaveHandler","yTos::Checkout::LinkToShoppingBagClicked":"_cartLinkClickHandler","yTos::Cart::MiniCartMouseEnter":"_mouseEnterHandler","yTos::Cart::MiniCartMouseLeave":"_mouseLeaveHandler","yTos::Account::AddAllItemsFromWishListDone":"_updateOnItemsAdded","yTos::Cart::SalesTaxCalculatorSuccess":"forceShow","yTos::Cart::ItemRemoved":"_updateOnItemRemoved","yTos::Cart::ItemsDeleted":"_updateOnItemRemoved","yTos::Cart::RefreshMiniCart":"forceUpdate","yTos::Account::UserLoggedIn":"_updateAfterUserAuth","yTos::Account::UserLoggedOut":"_updateAfterUserAuth","yTos::Cart::ItemDetailsChanged":"forceUpdate","yTos::Cart::ErrorChangingItemsDetail":"forceUpdate","yTos::Paypalexpress::ItemAvailabilityRectified":"forceUpdate","yTos::Cart::ShowMiniCart":"_appear","yTos::Cart::HideMiniCart":"_disappear","yTos::Checkout::RemoveItemSuccess":"_updateOnItemRemoved"},form:{},_appear:function(){this.$el.addClass("open"),$Y.notify("yTos::Cart::MiniCartVisible")},_disappear:function(){this.$el.removeClass("open"),$Y.notify("yTos::Cart::MiniCartHidden")},show:function(a){(this.options.showIfEmpty||a)&&(this.notify("yTos::Cart::ShowMiniCart"),this.update())},hide:function(){$Y.isVisible(this.el)&&this.$el.hasClass("open")&&this.notify("yTos::Cart::HideMiniCart")},_cartLinkMouseEnterHandler:function(a){this.options.showOnCartLinkMouseEnter&&(this.options.hideOnCartLinkMouseLeave&&clearTimeout(this._hideTimeout),this.show(a.itemsInCart>0))},_cartLinkMouseLeaveHandler:function(){this.options.showOnCartLinkMouseEnter&&this.options.hideOnCartLinkMouseLeave&&(this._hideTimeout=setTimeout($.proxy(this.hide,this),this.options.hideTimeoutFromCartLink))},_cartLinkClickHandler:function(a){this.options.toggleOnCartLinkClick&&($Y.isVisible(this.el)&&this.$el.hasClass("open")?this.hide():this.show(a.itemsInCart>0))},_mouseEnterHandler:function(){clearTimeout(this._hideTimeout)},_mouseLeaveHandler:function(){var a=this.options;a.hideOnMiniCartMouseLeave&&(this._hideTimeout=setTimeout($.proxy(this.hide,this),a.hideTimeoutFromMiniCart))},_updateOnItemsAdded:function(){var a=this.options;this.isAddingItem=!0,a.hideOnItemAdded&&$Y.watchOne({"yTos::Cart::MiniCartUpdated":$.proxy(function(){this._hideTimeout=setTimeout($.proxy(this.hide,this),a.hideTimeoutOnItemAdded)},this)}),this.options.showOnItemAdded&&this.forceShow()},_updateOnItemRemoved:function(){this._isRemovingItem=!0,$Y.watchOne({"yTos::Cart::MiniCartUpdated":$.proxy(function(){this._hideTimeout=setTimeout($.proxy(this.hide,this),this.options.hideTimeoutOnItemAdded)},this)}),this.forceShow()},_updateAfterUserAuth:function(){this._updateOnNextCall=!0,$Y.isVisible(this.el)&&this.update()},forceShow:function(){this.show(!0)},forceUpdate:function(){this.update(!0)},update:function(a){var b,c=this._updateOnNextCall||this.isAddingItem||this._isRemovingItem||a;c&&(b=this.isAddingItem?{isAddingItem:!0}:void 0,this.getHTML({Area:this.options.activeCheckoutType,Controller:"Cart",Action:"MiniCartContent"},{success:$.proxy(function(a){this.notify("yTos::Cart::MiniCartUpdated",a)},this),autoUpdate:!0,data:b})),this.isAddingItem?(this.isAddingItem=!1,this._updateOnNextCall=!0):this._updateOnNextCall=!1,this._isRemovingItem=!1},_goToCartPage:function(a){a.preventDefault(),this.notify("yTos::MiniCart::GoToCartClicked",{isDefaultBehaviourDisabled:this.options.preventDefaultBehaviour}),window.location=a.currentTarget.href}}),yTos.helpers.Cart.MiniCart});