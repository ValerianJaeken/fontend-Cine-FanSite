define(["ytos.item","ui.selectAsList"],function(a,b){var c="disabled",d="selected";return yTos.utils.namespace("yTos.helpers.Item.SelectColor"),yTos.helpers.Item.SelectColor=yTos.helpers.base.extend({initialize:function(){this.domReady=!1,"undefined"!=typeof yTos.collections.item&&"undefined"!=typeof yTos.collections.item[this.scope]&&(this.domReady=!0),this.model=yTos.models.ItemsCollection({scope:this.scope},{code10:this.options.code10,siteCode:this.options.siteCode,disableGetCombination:this.options.disableGetCombination}),this.options.disableGetCombination||this.model.getCombinations();var a=this.model.get("selectedColor");a||"undefined"==typeof this.options.code10||(this.model.attributes.selectedColor=this.options.code10),this.model.watch("change:availableColors",this.updateAvailableColors,this),this.model.watch("change:selectedColor",this.updateSelected,this),a&&this.updateSelected(),this.model.get("combinationsReady")&&this.updateColors()},events:function(){var a={"li[data-ytos-color-selector] click":"colorClicked",click:"openDropDown","select change":"colorClicked",mouseenter:"colorsMouseenter",mouseleave:"colorsMouseleave"};return this.options.showAvailabilityOnHover&&(a["li[data-ytos-color-selector] mouseenter"]="notifyColorSelectorMouseEntered",a["li[data-ytos-color-selector] mouseleave"]="notifyColorSelectorMouseLeaved"),a},localMessages:{"yTos::Item::SizeSelectorMouseEntered":"updateAvailableColorsOnSizeSelectorMouseEntered","yTos::Item::SizeSelectorMouseLeaved":"resetAvailableColorsOnSizeSelectorMouseLeaved","yTos::Item::CombinationsReady":"updateColors"},requiredHelpers:{SelectAsList:b},openDropDown:function(){if(this.domReady&&this.options.enableDropDownBehaviour){this.notify("yTos::Item::SelectionDropdownClick",{element:this.$el});var a=this.model.get("Colors");"click"===this.options.dropDownOpenEvent&&"undefined"!=typeof a&&a.length>1&&this.$el.toggleClass("open")}},colorClicked:function(a){a.stopPropagation();var b=this._getModelColor($(a.currentTarget)),c=b.code10;this.setPlaceholder(),this.setColor(c);var d=this.model.get("selectedSize");this.notify("yTos::Item::ColorChanged",{code10:c,size:d,prefixScope:this.options.prefixScope}),this.notify("yTos::Item::ColorChanged",{code10:c,size:d,prefixScope:this.options.prefixScope},{scope:this.scope}),this.notify("yTos::Item::NotifyColorChanged",{code10:c,size:d})},_getModelColor:function(a){var b;return b="DropDownList"===this.options.colorViewType?a.find(":selected").data("ytosMdl"):a.data("ytosMdl"),b||{code10:""}},checkItemIsAlreadyInCart:function(a,b){var c=this.model.getCombinationModel(a,b);return c&&0!==c.QuantityInCart?void this.notify("yTos::Item::ItemAlreadyInCartClicked",c):void this.notify("yTos::Item::ItemNotInCartClicked",{code10:a,sizeId:b})},colorsMouseenter:function(){if(this.domReady&&this.options.enableDropDownBehaviour){var a=this.model.get("Colors");this.notify("yTos::Item::SelectionDropdownMouseenter",{element:this.$el}),"undefined"!=typeof a&&a.length>1&&"hover"===this.options.dropDownOpenEvent&&this.$el.addClass("open")}},colorsMouseleave:function(){if(this.domReady&&this.options.enableDropDownBehaviour){var a=this.model.get("Colors");this.notify("yTos::Item::SelectionDropdownMouseleave",{element:this.$el}),"undefined"!=typeof a&&a.length>1&&"hover"===this.options.dropDownOpenEvent&&this.$el.removeClass("open")}},notifyColorSelectorMouseEntered:function(a){var b=$(a.currentTarget).data("ytos-mdl").code10;$Y.notify("yTos::Item::ColorSelectorMouseEntered",this.model.get("availabilityByColor")[b],{scope:this.scope})},notifyColorSelectorMouseLeaved:function(){$Y.notify("yTos::Item::ColorSelectorMouseLeaved",{},{scope:this.scope})},updateAvailableColors:function(a,b){var e=$("[data-ytos-color-label]",this.$el);a||(a=[]);var f=b?"disabledFromHover":c;$("[data-ytos-color-selector]",this.$el).removeClass(f).each(function(c,g){var h=$(g),i=h.data("ytos-mdl").code10,j=0===a.filter(function(a){return a.Code10===i}).length;j&&(h.addClass(f),h.hasClass(d)&&!b&&(h.removeClass(d),h.attr("selected",!1),e.find(".text").html(e.data("ytos-color-label")),this.model.set("isValidSelection",!1)))}.bind(this))},updateAvailableColorsOnSizeSelectorMouseEntered:function(a){this.updateAvailableColors(a,!0)},resetAvailableColorsOnSizeSelectorMouseLeaved:function(){$("[data-ytos-color-selector]",this.$el).removeClass("disabledFromHover")},updateSelected:function(a){var b=this.model.get("Colors"),e=("undefined"!=typeof a?a:this.model.get("selectedColor"))||"",f=this.$el.find("[data-ytos-color-selector]"),g=f.filter(function(a,b){var c=$(b).data("ytos-mdl");return c&&c.code10&&c.code10.toLowerCase()===e.toLowerCase()})[0],h=!!g&&$(g).hasClass("disabled")&&"boolean"!=typeof this.model.get("selectedSize");"undefined"!=typeof b&&1===b.length&&this.$el.addClass("oneOption");var i=this.$("[data-ytos-color-label]");f.each(function(a,b){var f=$(b),g=f.data("ytos-mdl"),j=this.$el.find("select");h&&f.removeClass("disabled");var k="undefined"!=typeof g&&g.code10&&g.code10.toLowerCase()===e.toLowerCase();k&&(f.is("option")?(f.removeClass(c).addClass(d).attr("selected",!0).siblings().removeClass(d).attr("selected",!1),"undefined"!=typeof j.data("ytos-dropdown")&&j.data("ytos-dropdown").set(j,g.id)):f.removeClass(c).addClass(d).siblings().removeClass(d),i.find(".text").html(f.text()),this.notify("yTos::Item::SelectColor::ColorSelected",{element:f,position:f.index(),pageZone:this.options.pageZone}))}.bind(this))},setColor:function(a){var b=this.domReady?a.toUpperCase():this.tryRectifyLandingSelectedColor(a);this.updateSelected(b),this.notify("yTos::Item::checkSelection",{Selection:{type:"color",value:b}},{scope:this.scope}),this.notify("yTos::Item::ItemColorChanged",b.toLowerCase(),{scope:this.scope}),this.checkItemIsAlreadyInCart(a,this.model.get("selectedSize"))},tryRectifyLandingSelectedColor:function(a){var b=a.toUpperCase();if(this.options.disableSoldOutRectificationOnLanding)return b;var c=this.model.get("Colors");return 0===c.length?b:$Y.where({Code10:b},c).length>0?b:c[0].Code10},setPlaceholder:function(){var a=$("*[data-ytos-color-label]",this.$el);a.find(".text").html(a.data("ytos-color-label"))},updateColors:function(){this.getHTML("/ItemPlugin/RenderSelectColor",{data:$Y.prepareData(this.options),success:function(a){var b=this.options.code10;this.notify("yTos::Item::ColorsInfoUpdated",a),this.notify("yTos::Ui:PicturePolyfill::PictureUpdated",{$el:this.$el}),this.setColor(b),this.domReady=!0}.bind(this),stripMe:!0,autoUpdate:!0})}}),yTos.helpers.Item.SelectColor});