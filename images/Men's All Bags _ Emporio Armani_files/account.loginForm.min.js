define(["ytos.account","ui.layer","ui.ajaxForm","ui.recaptcha"],function(a,b,c,d){return yTos.utils.namespace("yTos.helpers.Account.LoginForm"),yTos.helpers.Account.LoginForm=yTos.helpers.base.extend({initialize:function(){this.refreshOnLoad()},events:{"[data-ytos-proceed-as-guest] click":"onProceedAsGuest"},globalMessages:{"yTos::Account::UserLoggedIn":"onLoginSuccess","yTos::Account::UserLoginError":"onLoginError","yTos::Account::UserRegisteredInOtherCountry":"yTos::OpenLayer","yTos::Account::UserImported":"yTos::OpenLayer"},requiredHelpers:function(){var a={};return this.$el.find("[data-ytos-captcha]").length>0&&(a.Recaptcha=d),a},form:{success:"onUserLoggedIn",error:"onLoginError"},refreshOnLoad:function(){0===this.$("form").length&&this.refresh()},refreshOnAntiforgeryException:function(){this.refresh()},refresh:function(){this.getHTML("/yTos/Plugins/AccountPlugin/RenderLoginForm",{data:this.options,success:function(){this.notify("yTos::Account::LoginFormRefreshed")}.bind(this),stripMe:!0,autoUpdate:!0})},onUserLoggedIn:function(a){$Y.notify("yTos::Account::UserLoggedIn",{content:a}),this.options.isGuestLoginForm&&$Y.notify("yTos::Cart::UserLoggedIn",{content:a}),$Y.notify("yTos::Account::UserLoginSuccess")},onLoginSuccess:function(a){var b=window!==window.top;b?(yTos.cookies.set("LOGGED",!0),"undefined"!=typeof a&&this.$el.replaceWith(a.content)):this.options.redirectAfterLogin&&""!==this.options.redirectAfterLogin?$Y.redirect(this.options.redirectAfterLogin):"undefined"!=typeof a&&this.$el.replaceWith(a.content)},onLoginError:function(a,b){switch(b){case 409:this.notify("yTos::Account::UserRegisteredInOtherCountry",{content:a});break;case 452:this.notify("yTos::Account::UserImported",{content:a})}this.notify("yTos::Account::UserLoginFail")},onProceedAsGuest:function(a){this.notify("yTos::Account::ProceedAsGuestClicked"),this.notify("yTos::Common::ProceedAsGuestClicked"),this.notify("yTos::CloseLayer")}}),yTos.helpers.Account.LoginForm});