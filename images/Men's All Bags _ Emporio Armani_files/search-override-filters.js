"use strict";!function($,$Y){var e="dead",t="refinementSingle",i="selected",s="disabled",n=".refinement",r=".refinements",o=$(n+"issale"),l=o?o.data("sale-label"):"View All",a=function(){$(r).find("li.Issale").each(function(e,t){return"false"===JSON.parse(t.dataset.ytosMdl).id?$(t).addClass("hidden"):$(t).find(".text").eq(0).html(l),t})},d=function(){$(r).find("li").each(function(e,n){var r=$(n);r.removeClass(t);var o=r.siblings(),l=o.filter(function(e){return $(o[e]).hasClass(s)});o.length===l.length&&(r.addClass(i),r.addClass(t))})};$Y.watchOne({"yTos::HelperParsed::search.refinements":function(r){"function"==typeof r&&(r.prototype.updateFilters=function(e){if("sortRule"===e.key)return!1;this.updateHTML()},r.prototype.updateHTML=function(){var t=this,r=t.model.attributes.lastFilterClicked?t.model.attributes.lastFilterClicked.key:"",o=t.model.get("filters").gender;Array.isArray(o)&&(o=o.join(","));var a=JSON.parse(JSON.stringify(t.model.get("filters"))),d=t.options.dimension,f=d.toLowerCase(),u="Gender"===d,p="",h=$(n+d),c=h.find("."+d);Object(a).hasOwnProperty(f)&&(p=a[f]);var y=function(t){var s=JSON.parse(t.dataset.ytosMdl),n=$.isArray(p)&&p.indexOf(s.id)>=0||p===s.id;return""!==p&&n?$(t).addClass(i):$(t).removeClass(i),s.unselectable?$(t).addClass(e):$(t).removeClass(e),"issale"===s.dimension&&("false"===s.id?$(t).addClass("hidden"):$(t).find(".text").eq(0).html(l)),t};f!==r?function(){delete a[f];var e=$Y.prepareData({siteCode:yTos.navigation.SiteCode,gender:u?"":o,apiRequest:yTos.utils.jsonToQueryString(a),options:{RefinementType:d,RefinementViewType:t.options.viewType,ViewAllPosition:t.options.viewAllPosition,ColorRefinementType:t.options.colorRefinementType,NormalizeGender:t.options.normalizeGender,LowerCaseFilterValue:t.options.lowerCaseFilterValue}});t.getHTML("/yTos/Plugins/SearchPlugin/GetRefinements",{data:e,success:function(e){h.html(""),e.each(function(e,t){return h.append(y(t))});var i=JSON.parse(JSON.stringify(t.model.attributes.filters)),r=function(e,t){if(e&&(e.hasOwnProperty(t)||e[t])){var i=e[t],r=$(n+t).find("li."+s),o=r?r.map(function(e){return JSON.parse(r[e].dataset.ytosMdl).id}).toArray():[];"season"!==t||$.isArray(i)||""!==i&&(i=i.split(","),e[t]=i),o&&o.length>0&&($.isArray(i)?(i=i.filter(function(e){return o.indexOf(e)<0}),e[t]=i):o.indexOf(i)>=0&&delete e[t]),($.isArray(i)&&(0===i.length||1===i.length&&""===i[0])||""===i)&&delete e[t]}return e}(Object(t.model.attributes.filters),f);(!$.isArray(i[f])&&r[f]!==i[f]||$.isArray(i[f])&&r[f].length!==i[f].length)&&(t.model.set("filters",r),t.model.pushState()),t.notify("yTos::Search::filtersUpdated")}.bind(t),stripMe:!0,autoUpdate:!1})}():c.each(function(e,t){return y(t)})},r.prototype.onFilterClicked=function(e){e.preventDefault(),e.stopPropagation();var i="",s="";if("DropDownList"===this.options.viewType){if("viewall"===(i=this.$el.find(":selected").data()).ytosButton)return void this.onViewAllClicked(e)}else i=$(e.currentTarget).data(),s=$(e.currentTarget);if(i.ytosMdl.unselectable){if(this.notify("yTos::Search::disabledFilterClicked"),!this.options.EnableSelectionOfDisabledFilter&&"Brand"!==this.options.dimension)return}else if(s.hasClass(t))return;this.model.get("firstPushState")||(this.model.set({firstPushState:!0}),this.model.pushState());var n={};n[i.ytosMdl.dimension]=i.ytosMdl.id;var r=!!this.options.FilterInMultiSelection&&$Y.isIn(i.ytosMdl.dimension,this.options.FilterInMultiSelection);if(this.model.toggleFilters(n,r),this.options.EnableViewAll&&"DropDownList"!==this.options.viewType&&!s.parent().hasClass("refinementChildren")&&void 0!==this.options.totalFilters&&Array.isArray(this.model.attributes.filters[i.ytosMdl.dimension])&&this.model.attributes.filters[i.ytosMdl.dimension].length===this.options.totalFilters){var o=this.options.dimension;"macro"===o&&(o="micro"),this.model.emptyFilters(o)}})},"yTos::HelpersFinishedLoading":function(){a(),d(),$Y.watch({"yTos::Search::filtersUpdated":function(){return d()}})}})}(jQuery,yTos);
//# sourceMappingURL=search-override-filters.js.map
