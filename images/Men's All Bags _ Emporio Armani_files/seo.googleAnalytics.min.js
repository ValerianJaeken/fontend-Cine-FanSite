define([("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/analytics.js"],function(){return yTos.utils.namespace("yTos.tracking.GoogleAnalytics"),yTos.tracking.GoogleAnalytics=yTos.helpers.base.extend({_active:function(){return"undefined"==typeof this.options.DisableTrackingInfo||!this.options.DisableTrackingInfo},initialize:function(){var a=this.options.Domain;this.GACodes=this.options.TrackingInfo[0].Codes,this.DemographicsAndInterests=this.options.DemographicsAndInterests,this.IsEurTheCurrencyForTracking=this.options.IsEurTheCurrencyForTracking,this.EnableDomainsToAutoLink=this.options.EnableDomainsToAutoLink,this.DomainsToAutoLink=this.options.DomainsToAutoLink,this.GATracker=[],this._active()&&(this.EnableDomainsToAutoLink?(ga("require","linker"),ga("linker:autoLink",this.DomainsToAutoLink),this.GACodes.forEach(function(a,b){ga("create",a,"auto",{allowLinker:!0,name:"tracker_"+b}),this.GATracker.push("tracker_"+b)}.bind(this))):this.GACodes.forEach(function(b,c){ga("create",b,{allowLinker:!0,cookieDomain:a,name:"tracker_"+c}),this.GATracker.push("tracker_"+c)}.bind(this)),yTos.tracking.registerDriver("GA",this),this.options.EnableOptimizelyIntegration&&this.enableOptimizelyIntegration(),this._setCustomDimensions(),yTos.configuration.dataLayer&&this.parseDataLayer())},globalMessages:function(){return this._active()?{"yTos::UserDataLayerInitialized":"parseDataLayer"}:{}},enableOptimizelyIntegration:function(){window.optimizely=window.optimizely||[],window.optimizely.push("activateUniversalAnalytics")},userAction:function(){return yTos.debug.log("CALLED UNUSED METHOD 'userAction'"),!1},_getPageString:function(){var a=yTos.navigation.Action,b=yTos.navigation.Controller;return"index"!==a?b+"."+a:b},trackEvent:function(a){var b=a.length>0?a[0]:a;if("undefined"!=typeof b.driver&&"GA"!==b.driver)return!1;var c,d=b.section?b.section:this._getPageString(),e=("undefined"!=typeof b.prefix?b.prefix:"")+b.event,f=b.label;if($.isNumeric(b.value)&&(c=b.value),!e)return void yTos.debug.log("trackEvent called without event name");var g={};b.hitCallback&&(g.hitCallback=b.hitCallback()),"undefined"!=typeof b.nonInteraction&&(g.nonInteraction=b.nonInteraction);for(var h=0;h<this.GATracker.length;h++)ga(this.GATracker[h]+".send","event",d,e,f,c,g)},trackProductData:function(a){return!1},trackAddItem:function(a){return!1},trackRemoveItem:function(a){return!1},trackTransactionInEuro:function(a,b){for(var c=0,d=a.ItemsTrackingData.length;c<d;c++){var e=a.ItemsTrackingData[c],f=$Y.where({order_item_cod10:e.Sku},a.order_items);f.length>0&&(f=f[0]);var g=f||{};ga(this.GATracker[b]+".ecommerce:addItem",{id:(e.OrderId||"").toLowerCase(),name:e.Name,sku:e.Sku,category:e.Category,price:g.order_item_discount_tf,quantity:e.Quantity,currency:yTos.configuration.dataLayer.nav_currency.toUpperCase()})}ga(this.GATracker[b]+".ecommerce:addTransaction",{id:(a.order_id||"").toLowerCase(),affiliation:yTos.navigation.SiteCode,revenue:a.order_amount_tf_without_sf,shipping:a.order_shipping,tax:a.order_tax,currency:yTos.configuration.dataLayer.nav_currency.toUpperCase()})},trackTransactionWithStandardCurrency:function(a,b){for(var c=0,d=a.ItemsTrackingData.length;c<d;c++){var e=a.ItemsTrackingData[c],f=$Y.where({order_item_cod10:e.Sku},a.order_items)[0]||{};ga(this.GATracker[b]+".ecommerce:addItem",{id:(e.OrderId||"").toLowerCase(),name:e.Name,sku:e.Sku,category:e.Category,price:f.order_item_discount_tf,quantity:e.Quantity,currency:yTos.configuration.dataLayer.nav_currency.toUpperCase()})}ga(this.GATracker[b]+".ecommerce:addTransaction",{id:(a.order_id||"").toLowerCase(),affiliation:yTos.navigation.SiteCode,revenue:a.order_revenue,shipping:a.order_shipping,tax:a.order_tax,currency:yTos.configuration.dataLayer.nav_currency.toUpperCase()})},_trackTransaction:function(a){for(var b=0;b<this.GATracker.length;b++){if(ga(this.GATracker[b]+".require","ecommerce","ecommerce.js"),this.IsEurTheCurrencyForTracking?this.trackTransactionInEuro(a,b):this.trackTransactionWithStandardCurrency(a,b),a.cart_ispickupinstoreselected&&ga(this.GATracker[b]+".set","dimension8","pickup"),a.order_DeliveryTypeId&&ga(this.GATracker[b]+".set","dimension15",a.order_DeliveryTypeId),a.order_PaymentTypeId&&ga(this.GATracker[b]+".set","dimension12",a.order_PaymentTypeId),a.nav_storic_countryCode&&ga(this.GATracker[b]+".set","dimension10",(a.nav_storic_countryCode||"").toUpperCase()),yTos.navigation&&yTos.navigation.AreaIsoCode&&ga(this.GATracker[b]+".set","dimension11",(yTos.navigation.AreaIsoCode||"").toUpperCase()),a.nav_currency&&ga(this.GATracker[b]+".set","dimension14",(a.nav_currency||"").toUpperCase()),"undefined"!=typeof a.abtests&&null!==a.abtests&&a.abtests.length>0){for(var c,d=[],e=0;e<a.abtests.length;e++)c=a.abtests[e],d[e]=c.Name+"_"+c.Perc+"_"+c.Active;ga(this.GATracker[b]+".set","dimension3",d.join("|"))}ga(this.GATracker[b]+".ecommerce:send")}},_setCustomDimensions:function(){for(var a=(yTos.navigation.itemData||yTos.navigation).Gender||"X",b=0;b<this.GATracker.length;b++)if(ga(this.GATracker[b]+".set","dimension4",a),ga(this.GATracker[b]+".set","dimension6",this._getPageString()+":"+a),"Search"===yTos.navigation.Controller){var c=$Y.storage.get("yTos.navigation.LatestSearchFilters");c?ga(this.GATracker[b]+".set","dimension1",c.department):yTos.search&&yTos.search.department&&ga(this.GATracker[b]+".set","dimension1",yTos.search.department)}},parseDataLayer:function(){var a=yTos.configuration.dataLayer||{};"ThankYou"!==yTos.navigation.Controller&&"WaitToBuy"!==yTos.navigation.Controller||this._trackTransaction(a);for(var b=0;b<this.GATracker.length;b++){if(a.user_logged&&ga(this.GATracker[b]+".set","dimension2","logged"),a.product_brand&&ga(this.GATracker[b]+".set","dimension5",a.product_brand),null!==yTos.configuration.dataLayer.product_category&&ga(this.GATracker[b]+".set","dimension7",a.product_category),a.order_DeliveryTypeId&&ga(this.GATracker[b]+".set","dimension15",a.order_DeliveryTypeId),a.cart_ispickupinstoreselected&&ga(this.GATracker[b]+".set","dimension8","pickup"),a.order_PaymentTypeId&&ga(this.GATracker[b]+".set","dimension12",a.order_PaymentTypeId),"undefined"!=typeof a.abtests&&null!==a.abtests&&a.abtests.length>0){for(var c,d=[],e=0;e<a.abtests.length;e++)c=a.abtests[e],d[e]=c.Name+"_"+c.Perc+"_"+c.Active;ga(this.GATracker[b]+".set","dimension3",d.join("|"))}this.DemographicsAndInterests===!0&&ga(this.GATracker[b]+".require","displayfeatures"),this.trackPageView(b)}},trackPageView:function(a){a=a||0;var b=window.location.pathname.slice(1),c="D"===yTos.navigation.Gender?"F":"M",d="?fnl=";switch(yTos.navigation.Controller.toLowerCase()){case"search":d+="searchResult_"+c+"_"+yTos.search.department;break;case"errors":switch(yTos.navigation.Action.toLowerCase()){case"404":d+="Error_404"}break;default:d+=yTos.navigation.Controller.toLowerCase()+"&controller="+this._getPageString()}b+=d+window.location.search.replace("?","&"),ga(this.GATracker[a]+".send",{hitType:"pageview",page:b})},trackPromotionsImpression:function(a){return!1},trackPromotionsClick:function(a){return!1},trackVirtualPageView:function(a){return!1}}),yTos.tracking.GoogleAnalytics});