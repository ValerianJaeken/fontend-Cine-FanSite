define([],function(){return yTos.utils.namespace("yTos.tracking.TagCommander"),yTos.tracking.TagCommander=yTos.helpers.base.extend({loadedTagCommanderScripts:!1,formatPrice:function(a,b,c,d){var e=a;b=isNaN(b=Math.abs(b))?2:b,c=void 0===c?",":c,d=void 0===d?".":d;var f=e<0?"-":"",g=parseInt(e=Math.abs(+e||0).toFixed(b),10)+"",h=(h=g.length)>3?h%3:0;return f+(h?g.substr(0,h)+d:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(e-g).toFixed(b).slice(2):"")},initialize:function(){this.options.enableEventsTracking&&yTos.tracking.registerDriver("TC",this),yTos.configuration.dataLayer&&this.extendDataLayer(),$Y.watch({"yTos::Search::ProductsReady":$.proxy(this.updateSrItems,this)})},globalMessages:{"yTos::UserDataLayerInitialized":"extendDataLayer","yTos::Search::filterAdded":"updateSearchFiltersValues","yTos::Item::QuickBuyLayerHtmlReady":"setQuickBuyOpened","yTos::ItemsListUpdated":"updateItemsList","yTos::Search::ProductsReady":"updateItemsList","yTos::Item::RecentlyViewedHTMLReady":"updateItemsList"},setQuickBuyOpened:function(a){this.extendTcVars({env_template:"item",nav_section:"cts",nav_pagetype:"item"})},updateSearchFiltersValues:function(a){var b={};switch(a.key){case"color":b.sr_color=a.value;break;case"size":b.sr_size=a.value}this.extendTcVars(b),this.extendDataLayerWithSrProps(a.key),this.loadTagCommanderScripts()},updateSrItems:function(){window.tc_vars.sr_items={};var a={},b=[];$("[data-ytos-item-code10], [data-ytos-item]").each(function(a,c){var d=$(c),e=d.data("ytosItemCode10")||d.data("ytosItem"),f=d.data("ytosTrackProductData")||{},g=this.formatPrice(f.product_price,2,".",","),h=this.formatPrice(f.product_discountedPrice,2,".",","),i=this.formatPrice(f.product_price_tf,2,".",","),j=this.formatPrice(f.product_discountedPrice_tf,2,".",","),k=d.find('[itemprop="title"]'),l=k.length>0?k.get(0).innerText:"",m=d.find('[data-ytos-ctrl="item.modelName"]'),n=m.length>0?m.get(0).innerText:"",o=k.length>0?l:n;o=jQuery.trim(o),b.push({sr_item_cod8:e.toString().substr(0,8),sr_item_cod10:e,sr_item_name:o,sr_item_unitprice_ati:g,sr_item_unitprice_tf:i,sr_item_discount_ati:h,sr_item_discount_tf:j,sr_item_quantity:"",sr_item_macro_category:f.product_macro_category,sr_item_macro_category_id:f.product_macro_category_id,sr_item_micro_category:f.product_micro_category,sr_item_micro_category_id:f.product_micro_category_id,sr_item_brand:f.product_brand,sr_item_color:f.product_color,sr_item_color_id:f.product_color_id,sr_item_position:f.product_position,sr_item_list:"searchresult",product_variant_id:f.product_variant_id,product_id:f.product_id,product_legacy_macro_id:f.product_legacy_macro_id,product_legacy_micro_id:f.product_legacy_micro_id})}.bind(this)),a.sr_items=b,this.extendTcVars(a)},tryGetNewestItemsList:function(a,b){return Object.keys(a).reduce(function(c,d){return b&&b.hasOwnProperty(d)||c.push(a[d]),c},[])},updateItemsList:function(){var a=window.tc_vars.itemsList;window.tc_vars.itemsList={};var b={},c=[];$("[data-ytos-track-product-data]").each(function(a,b){var d=$(b),e=d.data("ytosTrackProductData")||{},f=e.product_cod10||"",g=this.formatPrice(e.product_price,2,".",","),h=this.formatPrice(e.product_discountedPrice,2,".",","),i=this.formatPrice(e.product_price_tf,2,".",","),j=this.formatPrice(e.product_discountedPrice_tf,2,".",","),k=e.list?e.list:"searchresult";c[k]||(c[k]=[]),c[k].push({item_cod8:f.toString().substr(0,8),item_cod10:f,item_name:e.product_title,item_unitprice_ati:g,item_unitprice_tf:i,item_discount_ati:h,item_discount_tf:j,item_quantity:"",item_macro_category:e.product_macro_category,item_macro_category_id:e.product_macro_category_id,item_micro_category:e.product_micro_category,item_micro_category_id:e.product_micro_category_id,item_brand:e.product_brand,item_color:e.product_color,item_color_id:e.product_color_id,item_position:e.product_position,item_list:e.list,item_inpressionAdded:!1,product_variant_id:e.product_variant_id,product_id:e.product_id,product_legacy_macro_id:e.product_legacy_macro_id,product_legacy_micro_id:e.product_legacy_micro_id})}.bind(this)),b.itemsList=c,this.extendTcVars(b),$Y.notify("yTos::TagCommander::TcVarsItemsListUpdated");var d=c,e=this.tryGetNewestItemsList(d,a);if("function"==typeof window.tc_events_19)return window.tc_events_19(this,"TcVarsItemsListUpdated",{newestItemsList:e})},extendDataLayerWithSrProps:function(a){var b={};yTos.search&&yTos.search.department&&"undefined"!=typeof a&&(b.nav_subsection=a,b.nav_page=a),this.updateSrItems(),this.updateItemsList(),this.trackPromotionsImpressions(),this.extendTcVars(b)},extendDataLayer:function(){if(this.extendDataLayerWithSrProps(),yTos.configuration.dataLayer.nav_dept=(yTos.navigation.itemData||yTos.navigation).Gender||"X",this.extendTcVars(yTos.configuration.dataLayer),"function"==typeof yTos.configuration.dataLayerFilter)try{yTos.configuration.dataLayerFilter()}catch(a){yTos.debug.log("Error while processing yTos.configuration.dataLayerFilter","error")}this.loadTagCommanderScripts()},extendTcVars:function(a){$.extend(!0,window.tc_vars,a);for(var b in window.tc_vars)if(window.tc_vars.hasOwnProperty(b)){var c=window.tc_vars[b];null==c&&(window.tc_vars[b]="")}window.tc_vars&&""===window.tc_vars.nav_pagetype&&(window.tc_vars.nav_pagetype=this._getPageString())},loadTagCommanderScripts:function(){this.loadedTagCommanderScripts||(this.loadedTagCommanderScripts=!0,this.options.fileName.forEach(function(a){require([this.options.cdnBasePath+a],function(){this.notify("yTos::TagCommanderCalled")}.bind(this))}.bind(this)))},userAction:function(){return!1},_getPageString:function(){var a=yTos.navigation.Action,b=yTos.navigation.Controller;return"index"!==a?b+"."+a:b},trackEvent:function(a,b){var c=a.length>0?a[0]:a;if("undefined"!=typeof c&&"undefined"!=typeof c.driver&&"TC"!==c.driver||"function"!=typeof window.tc_events_19)return!1;var d={category:(b?c.category:window.tc_vars.nav_GAsection+(c.suffix||""))||"-",event:c.event,label:c.label};return window.tc_events_19(this,"univ",d)},trackProductData:function(a,b){var c=a.length>0?a[0]:a;return"function"==typeof window.tc_events_19&&window.tc_events_19(this,b||"enh_prod",{pid:c.product_cod10,name:c.product_title,brand:c.product_brand,category:c.product_category,variant:c.product_color,price:c.product_price,price_tf:c.product_price_tf,discountedPrice:c.product_discountedPrice,discountedPrice_tf:c.product_discountedPrice_tf,quantity:c.product_quantity||1,coupon:c.product_coupon||"",position:c.product_position,list:c.list,product_variant_id:c.product_variant_id,product_id:c.product_id,legacy_micro_id:c.product_legacy_micro_id,legacy_macro_id:c.product_legacy_macro_id})},trackAddItem:function(a){var b=a.length>0?a[0]:a;return"function"==typeof window.tc_events_19&&window.tc_events_19(this,"enh_addcart",{pid:b.product_cod10,name:b.product_title,category:b.product_category,brand:b.product_brand,variant:b.product_color||"",price:b.product_price,discount_price:b.product_discount_price,price_ati:b.product_price_ati,discount_price_ati:b.product_discount_price_ati,quantity:b.product_quantity||1,product_variant_id:b.product_variant_id,product_id:b.product_id,legacy_micro_id:b.product_legacy_micro_id,legacy_macro_id:b.product_legacy_macro_id})},trackRemoveItem:function(a){var b=a.length>0?a[0]:a;return"function"==typeof window.tc_events_19&&window.tc_events_19(this,"enh_removecart",{pid:b.product_cod10,name:b.product_title,category:b.product_category,brand:b.product_brand,variant:b.product_color||"",price:b.product_price,discount_price:b.product_discount_price,price_ati:b.product_price_ati,discount_price_ati:b.product_discount_price_ati,quantity:b.product_quantity||1,product_variant_id:b.product_variant_id,product_id:b.product_id,legacy_micro_id:b.product_legacy_micro_id,legacy_macro_id:b.product_legacy_macro_id})},trackTransactionInEuro:function(a,b){return!1},trackTransactionWithStandardCurrency:function(a,b){return!1},_trackTransaction:function(a){return!1},_setCustomDimensions:function(){return!1},parseDataLayer:function(){return!1},trackPageView:function(a){return!1},trackPromotionsImpressions:function(){window.tc_vars.promos={};var a={},b=[];$("[data-ytos-track-promotions-data]").each(function(a,c){var d=$(c).data("ytos-track-promotions-data"),e={promotion_id:d.promotion_id,promotion_name:d.promotion_name,promotion_creative:d.promotion_creative,promotion_position:d.position};b.push(e)}.bind(this)),a.promos=b,this.extendTcVars(a),$Y.notify("yTos::TagCommander::TcVarsPromosListUpdated")},trackPromotionsClick:function(a){var b=a.length>0?a[0]:a;return"function"==typeof window.tc_events_19&&window.tc_events_19(this,"enh_trackPromotionClicks",{promotion_id:b.id,promotion_name:b.name,promotion_creative:b.creative,promotion_position:b.position})},trackVirtualPageView:function(a){var b=a.length>0?a[0]:a;return window.tc_vars&&b&&(window.tc_vars.nav_stepName=b.stepName),"function"==typeof window.tc_events_19&&window.tc_events_19(this,"virtualPageView",{stepName:b.stepName})}}),yTos.tracking.TagCommander});