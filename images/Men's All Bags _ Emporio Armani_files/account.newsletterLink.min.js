define(["ytos.account"],function(){return yTos.utils.namespace("yTos.helpers.Account.NewsletterLink"),yTos.helpers.Account.NewsletterLink=yTos.helpers.base.extend({initialize:function(){var a=$Y.safeGet(yTos.configuration,"dataLayer.user_logged");this.options.showOnFirstVisit&&!a&&this.openFormAutomatically(),this.toggleLoggedClass(a)},events:{click:"onClick"},globalMessages:{"yTos::Account::RenderNewsletterFormReady":"yTos::OpenLayer","yTos::Account::UserLoggedIn":"onUserIsLoggedIn","yTos::Account::UserLoggedOut":"onUserIsLoggedOut"},openFormAutomatically:function(){var a=null===yTos.cookies.cache("user_firstvisit");if(a||$Y.safeGet(yTos.configuration,"dataLayer.user_firstvisit")){var b=this.options.expireTime||129600;yTos.cookies.cache("user_firstvisit",!1,b),this.openForm()}},openForm:function(){var a={fillEmailWhenUserIsLogged:this.options.fillEmailWhenUserIsLogged,formInstance:this.options.formInstance};"undefined"!=typeof this.scope&&(a.jsScope=this.scope),this.notify("yTos::Account::ClickOnOpenNewsLetter"),this.getHTML("/yTos/Plugins/AccountPlugin/RenderNewsletterFormAsync",{data:a,success:function(a){this.notify("yTos::Account::RenderNewsletterFormReady",{content:a})}.bind(this),error:function(a){this.notify("yTos::Account::RenderNewsletterFormError",{content:a})}.bind(this)})},onClick:function(a){a.preventDefault(),this.openForm()},onUserIsLoggedIn:function(){this.toggleLoggedClass(!0)},onUserIsLoggedOut:function(){this.toggleLoggedClass(!1)},toggleLoggedClass:function(a){this.$el.toggleClass("isLogged",a)}}),yTos.helpers.Account.NewsletterLink});