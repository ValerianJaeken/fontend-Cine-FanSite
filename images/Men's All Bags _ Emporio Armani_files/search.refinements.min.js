define(["ytos.search","ui.selectAsList"],function(a,b){return yTos.utils.namespace("yTos.helpers.Search.Refinements"),yTos.helpers.Search.Refinements=yTos.helpers.base.extend({initialize:function(){this.model=yTos.models.Searches({scope:"mainSearch"}),this.model.get("mustUpdate")&&this.updateHTML()},globalMessages:{"yTos::Search::filtersFullReset":"updateHTML","yTos::Search::filterAdded":"updateFilters","yTos::Search::filterRemoved":"updateFilters","yTos::Search::filterReset":"updateFilters"},events:{'[data-ytos-button="filter"] click':"onFilterClicked",'[data-ytos-button="viewall"] click':"onViewAllClicked","select change":"onSelectChange"},requiredHelpers:{SelectAsList:b},onFilterClicked:function(a){a.preventDefault(),a.stopPropagation();var b="",c="";if("DropDownList"===this.options.viewType){if(b=this.$el.find(":selected").data(),"viewall"===b.ytosButton)return void this.onViewAllClicked(a)}else b=$(a.currentTarget).data(),c=$(a.currentTarget);if(!b.ytosMdl.unselectable||(this.notify("yTos::Search::disabledFilterClicked"),this.options.EnableSelectionOfDisabledFilter)){this.model.get("firstPushState")||(this.model.set({firstPushState:!0}),this.model.pushState());var d={};d[b.ytosMdl.dimension]=b.ytosMdl.id;var e=$Y.isIn(b.ytosMdl.dimension,this.options.FilterInMultiSelection);if(this.model.toggleFilters(d,e),this.options.EnableViewAll&&"DropDownList"!==this.options.viewType&&!c.parent().hasClass("refinementChildren")&&"undefined"!=typeof this.options.totalFilters&&Array.isArray(this.model.attributes.filters[b.ytosMdl.dimension])&&this.model.attributes.filters[b.ytosMdl.dimension].length===this.options.totalFilters){var f=this.options.dimension;"macro"===f&&(f="micro"),this.model.emptyFilters(f)}}},onViewAllClicked:function(a){a.preventDefault(),a.stopPropagation();var b;if(!$(a.currentTarget).hasClass("selected")){if("DropDownList"===this.options.viewType){var c=$(a.currentTarget).find('[data-ytos-button="viewall"]');b=c.data("ytosMdl")}else b=$(a.currentTarget).data("ytosMdl");"macro"===b&&this.model.emptyFilters("micro"),this.model.emptyFilters(b)}},onSelectChange:function(a){return a.preventDefault(),a.stopPropagation(),"viewall"===a.currentTarget.value?void this.onViewAllClicked(a):void this.onFilterClicked(a)},updateFilters:function(a){return"sortRule"!==a.key&&void this.updateHTML()},updateHTML:function(){var a=this.model.get("filters").gender;Array.isArray(a)&&(a=a.join(",")),this.getHTML("/yTos/Plugins/SearchPlugin/GetRefinements",{data:$Y.prepareData({siteCode:yTos.navigation.SiteCode,gender:a,apiRequest:yTos.utils.jsonToQueryString(this.model.get("filters")),options:{RefinementType:this.options.dimension,RefinementViewType:this.options.viewType,ViewAllPosition:this.options.viewAllPosition,ColorRefinementType:this.options.colorRefinementType,NormalizeGender:this.options.normalizeGender,LowerCaseFilterValue:this.options.lowerCaseFilterValue}}),success:function(a){this.notify("yTos::Search::filtersUpdated")}.bind(this),stripMe:!0,autoUpdate:!0})}}),yTos.helpers.Search.Refinements});