define("ytos.item",[],function(){function a(a){var b=a.itemData,c=a.model;yTos.tracking.trackEvent({event:"AddToCart",label:b.code10,value:b.sizeId,driver:"GA"}),yTos.tracking.trackAddItem({product_cod10:b.code10,product_title:(c.productTitle||"").toUpperCase(),product_category:c.productCategoryId+"/"+c.productMicroId,product_brand:(c.productBrand||"").toUpperCase(),product_color:c.productColorId||b.Code10,product_price:c.productUnitpriceTf,product_discount_price:c.productDiscountTf,product_price_ati:c.productUnitpriceAti,product_discount_price_ati:c.productDiscountAti,product_quantity:1})}return yTos.utils.namespace("yTos.models.Item"),yTos.models.Item=yTos.models.base.extend({initialize:function(a){this.set("code8",this.get("code10").substr(0,8)),a&&a.disableGetCombination?$Y.watch({"yTos::Item::ColorChanged":function(a){this.get("combinationsReady")||this.set("selectedColor",a.code10)}.bind(this)},{scope:this.scope}):this.getCombinations()},localMessages:{"yTos::Cart::ItemIsAddedToCart":"onItemAddedToCart","yTos::Cart::ItemIsRemovedFromCart":"onItemRemovedFromCart"},onItemAddedToCart:function(a){a&&this.updateCombinationInCart(a,1)},onItemRemovedFromCart:function(a){a&&this.updateCombinationInCart(a,-1)},updateCombinationInCart:function(a,b){var c=a.code10.toUpperCase(),d=a.sizeId,e=this.getCombinationModel(c,d),f=this.get("ModelColorSizes")||[];"undefined"!=typeof e&&(e.QuantityInCart+=b,this.set("ModelColorSizes",f))},getCombinationModel:function(a,b){var c=this.get("ModelColorSizes")||[],d=$Y.where({Color:{Code10:a},Size:{Size:Number(b)}},c);return d[0]},getCombinations:function(){!this.get("combinationsReady")&&!this.get("isGettingCombinations")&&this.get("siteCode")&&this.get("code10")&&(this.set("isGettingCombinations",!0),yTos.ajax("/yTos/api/Plugins/ItemPluginApi/GetCombinationsAsync/",{data:{siteCode:this.get("siteCode"),code10:this.get("code10")},success:function(a){var b=this.parse(a);if(this.set(b),this._handleSpecialItems(this.get("code10")),this.get("selectedColor")){var c=this.get("availabilityByColor")[this.get("selectedColor")];this.set("availableSizes",c)}this.set("combinationsReady",!0),this._checkSelectionHandler=this.checkSelection.bind(this),$Y.watch({"yTos::Item::checkSelection":this._checkSelectionHandler},{scope:this.scope}),this.notify("yTos::Item::CombinationsReady",{response:a,code10:this.get("code10"),siteCode:this.get("siteCode")},{scope:this.scope})}.bind(this),error:function(){this.notify("yTos::Item::CombinationsError")}.bind(this)}))},destroy:function(){this._checkSelectionHandler&&$Y.unWatch({"yTos::Item::checkSelection":this._checkSelectionHandler},this.scope),this._super()},trackingHandlers:{"yTos::Item::ItemAddedToWishlist":function(a){yTos.tracking.trackEvent({event:"AddToWishList",label:a.itemData.code10,value:a.itemData.size})},"yTos::Item::AddItemToWishlistError":function(){yTos.tracking.trackEvent({event:"AddToWishList",label:"Error"})},"yTos::Item::ItemAdded":function(b){a(b)},"yTos::Item::ItemAddedToShoppingBag":function(b){a(b)},"yTos::Item::Zoom::Shown":function(a){yTos.tracking.trackEvent({event:"ZoomOpen",label:a.code10})},"yTos::Item::SendToAFriend::Error":function(){yTos.tracking.trackEvent({event:"SendToFriendForm",label:"Error"})},"yTos::Item::AlternativeImagesClicked":function(a){yTos.tracking.trackEvent({event:"SwitchImage",label:a.imgData.Code10})},"yTos::Item::RelatedItemClicked":function(a){yTos.tracking.trackEvent({event:"RelatedTo",label:a.currentCode10+"_"+a.newCode10})},"yTos::Item::RecentlyItemClicked":function(a){yTos.tracking.trackEvent({event:"Recently Viewed",label:a.currentCode10})},"yTos::Item::SameMicroItemClicked":function(a){yTos.tracking.trackEvent({event:"Same_Micro",label:a.currentCode10})},"yTos::Accordion::TrackSwitch":function(a){return"undefined"!=typeof a.code10&&void yTos.tracking.trackEvent({event:"ContentTabs",label:a.code10})}},defaults:{code10:"",siteCode:"undefined"!=typeof yTos.navigation?yTos.navigation.SiteCode:"",selectedColor:!1,selectedSize:!1,isValidSelection:!1,availableColors:!1,availableSizes:!1},checkSelection:function(a){var b,c="color"===a.Selection.type?a.Selection.value:this.get("selectedColor"),d="size"===a.Selection.type?a.Selection.value:this.get("selectedSize"),e=this.get("ModelColorSizes")||[],f=this.isCombinationAvailable(e,c,d);switch(a.Selection.type){case"color":var g=a.Selection.value.toUpperCase();b=this.get("availabilityByColor")[a.Selection.value],this.set("availableSizes",b),!f&&a.Selection.value&&this.set("selectedSize",!1),this.set("selectedColor",g),this._handleSpecialItems(g);break;case"size":b=this.get("availabilityBySize")[a.Selection.value],this.set("availableColors",b),!f&&a.Selection.value&&this.set("selectedColor",!1),this.set("selectedSize",a.Selection.value)}this.set("isValidSelection",f),this.setSelectedCombination(),this.notify("yTos::Item::ShareDataForClickAndReserve",{code8:this.get("code8"),itemInfo:{isAvailableOnline:f,color:this.get("selectedColor"),size:this.get("selectedSize")}}),this.sendValidSelectionMessage()},isCombinationAvailable:function(a,b,c){var d=!1;return b&&c&&a.forEach(function(a,e){try{a.Size.Size===c&&a.Color.Code10===b&&(d=!0)}catch(f){}}),d},setSelectedCombination:function(){var a=this.get("ModelColorSizes")||[];if(this.get("isValidSelection")){var b=a.find(function(a){return a.Color.Code10===this.get("selectedColor")&&a.Size.Size===this.get("selectedSize")},this);this.set("selectedModelColorSize",b),this.checkQuantity(b)}else this.set("selectedModelColorSize",!1)},checkQuantity:function(a){var b=this.get("ItemAvailabilityLimitQuantity")||0;if(a&&b){var c=a.Quantity;1===c?this.notify("yTos::Item::LastItemAvailable"):c<=b?this.notify("yTos::Item::LimitedAvailability"):this.notify("yTos::Item::FullyAvailability")}},sendValidSelectionMessage:function(){var a={itemSiteCode:this.get("siteCode"),code10:this.get("selectedColor"),size:this.get("selectedSize"),isValidSelection:this.get("isValidSelection")},b=this.get("isValidSelection")?"yTos::Item::SelectionValid":"yTos::Item::SelectionInvalid";this.notify(b,a,{scope:this.get("code10")})},parse:function(a){var b={},c={};return $(a.SizesByCode10).each(function(a,c){var d=[];$(c.Sizes).each(function(a,b){d.push(b)}),b[c.Code10]=d}),$(a.ModelColorSizes).each(function(d,e){var f=e.Size.Size,g=[],h=!1;$.each(b,function(b,c){$.each(c,function(a,b){b.Size===f&&(h=!0)}),h&&(Array.isArray(a.Colors)&&g.push(a.Colors.find(function(a){return a.Code10===b})),h=!1)}),c[f]=g}),a.availabilityByColor=b,a.availabilityBySize=c,a},_handleSpecialItems:function(a){var b=a.toUpperCase(),c=$Y.where({Code10:b},this.get("ItemsAvailabilityInfo"))[0]||{},d=0===$Y.where({Code10:b},this.get("Colors")).length&&!c.IsUnsellable;this.set("unsellable",!!c.IsUnsellable),this.set("soldOut",!!c.IsSoldOut),this.set("preorder",!!c.IsPreorder),this.notify(d?"yTos::Item::CombinationSoldOut":"yTos::Item::CombinationNotSoldOut",{code10:b},{scope:this.scope}),this.notify(c.IsUnsellable?"yTos::Item::Unsellable":"yTos::Item::Sellable",{code10:b}),this.notify(c.IsSoldOut?"yTos::Item::Soldout":"yTos::Item::InStock",{code10:b}),this.notify(c.IsPreorder?"yTos::Item::Preorder":"yTos::Item::NotPreorder",{code10:b})}}),yTos.models.ItemsCollection=yTos.helpers.createCollection(yTos.models.Item,"item"),yTos.models.Item});